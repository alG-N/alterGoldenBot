# Alertmanager Configuration for alterGolden
#
# Routes alerts to appropriate channels (Discord, Email, etc.)
# 
# Usage:
#   docker-compose --profile alerting up -d
#
# Important: Replace webhook URLs and email settings with your own!

global:
  # Resolve timeout
  resolve_timeout: 5m
  
  # SMTP settings (for email alerts)
  # smtp_smarthost: 'smtp.gmail.com:587'
  # smtp_from: 'alertmanager@altergolden.com'
  # smtp_auth_username: 'your-email@gmail.com'
  # smtp_auth_password: 'your-app-password'

# ═══════════════════════════════════════════════════════════════
# NOTIFICATION TEMPLATES
# ═══════════════════════════════════════════════════════════════
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# ═══════════════════════════════════════════════════════════════
# ROUTING CONFIGURATION
# ═══════════════════════════════════════════════════════════════
route:
  # Default receiver
  receiver: 'discord-notifications'
  
  # Group alerts by these labels
  group_by: ['alertname', 'severity']
  
  # Wait before sending first notification
  group_wait: 30s
  
  # Wait before sending subsequent notifications
  group_interval: 5m
  
  # Wait before resending notification
  repeat_interval: 4h

  # Child routes for specific alerts
  routes:
    # Critical alerts - immediate notification
    - match:
        severity: critical
      receiver: 'discord-critical'
      group_wait: 10s
      repeat_interval: 1h

    # Warning alerts
    - match:
        severity: warning
      receiver: 'discord-notifications'
      group_wait: 1m
      repeat_interval: 4h

    # Info alerts - less frequent
    - match:
        severity: info
      receiver: 'discord-notifications'
      group_wait: 5m
      repeat_interval: 12h

# ═══════════════════════════════════════════════════════════════
# RECEIVERS
# ═══════════════════════════════════════════════════════════════
receivers:
  # Discord webhook for general notifications
  - name: 'discord-notifications'
    webhook_configs:
      - url: 'YOUR_DISCORD_WEBHOOK_URL'
        send_resolved: true

  # Discord webhook for critical alerts (different channel)
  - name: 'discord-critical'
    webhook_configs:
      - url: 'YOUR_CRITICAL_DISCORD_WEBHOOK_URL'
        send_resolved: true

  # Email notifications (optional)
  # - name: 'email-notifications'
  #   email_configs:
  #     - to: 'admin@altergolden.com'
  #       send_resolved: true

  # Slack notifications (optional)
  # - name: 'slack-notifications'
  #   slack_configs:
  #     - api_url: 'YOUR_SLACK_WEBHOOK_URL'
  #       channel: '#alerts'
  #       send_resolved: true

# ═══════════════════════════════════════════════════════════════
# INHIBIT RULES
# ═══════════════════════════════════════════════════════════════
inhibit_rules:
  # If critical alert is firing, suppress warnings for same alertname
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname']

  # If bot is disconnected, suppress other bot alerts
  - source_match:
      alertname: 'BotDisconnected'
    target_match_re:
      alertname: '^(HighGatewayLatency|SlowCommandExecution)$'
